@using Microsoft.AspNetCore.Http;
@using Newtonsoft.Json;

@model buoi5.Models.Phieudathang

@{
    /**/

    ViewBag.Title = "Giỏ hàng";
}

<h2>Thông tin giỏ hàng</h2>
@Html.ActionLink("Trở về", "Index")

@{

    string? json = Context.Session.GetString("phieudathang");
    var session = Context.Session.GetString("Khachhang");

    Phieudathang? pdh = JsonConvert.DeserializeObject<Phieudathang>(json);
    Khachhang? kh = JsonConvert.DeserializeObject<Khachhang>(json);
    double tongTien = 0;
    QLBHContext db = new QLBHContext();

    var ct = pdh.Chitietphieudathang.ToList();

}

@if(pdh == null)
{
    <h3>Ban chua co hang hoa trong gio hang</h3>
}
else
{
    <table class="table table-bordered">
        <thead>
            <tr>
                <th>Mã hàng</th>
                <th>Tên hàng</th>
                <th>Đơn vị tính</th>
                <th>Đơn giá</th>
                <th>Số lượng</th>
                <th>Thành tiền</th>
                <th></th>
            </tr>
        </thead>

        <tbody>
            @foreach (var item in ct)
            {
                double thanhtien = (item.Soluong ?? 0) * (item.Dongia ?? 0);

                <tr>
                    <td>@item.Mahang</td>
                    <td>@item.MahangNavigation?.Tenhang</td>
                    <td>@item.MahangNavigation?.Donvitinh</td>
                    <td>@item.Dongia</td>
                    <td>@item.Soluong</td>
                    <td>@thanhtien</td>
                    <td><a href="#">Xóa</a></td>
                </tr>
            }
        </tbody>
    </table>
}



@if (session == null)
{
    <h3>ban chua dang nhap vao he thong</h3>
}else
{
    <form>
        <div class="form-group">
            <label asp-for="Mapdh" class="control-label"></label>
            <input asp-for="Mapdh" type="text" class="form-control" />
        </div>
        <div class="form-group">
            <label asp-for="Ngaydh" class="control-label"></label>
            <input asp-for="Ngaydh" type="date" class="form-control" />
        </div>
        <div class="form-group">
            <label asp-for="Ngaygh" class="control-label"></label>
            <input asp-for="Ngaygh" type="date" class="form-control" />
        </div>
        <div class="form-group">
            <label asp-for="Diachigh" class="control-label"></label>
            <input asp-for="Diachigh" type="text" class="form-control" />
        </div>
     

        <div class="form-group">
            <input type="submit" value="Lap don hang" class="btn btn-primary" />
        </div>
    </form>
}




